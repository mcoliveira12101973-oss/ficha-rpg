<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Ficha de RPG</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  background:#0e0e0e;
  color:#eee;
  font-family:Arial,sans-serif;
  padding:20px;
}
.ficha{
  max-width:1100px;
  margin:auto;
  background:#1a1a1a;
  padding:20px;
  border-radius:12px;
}
h1,h2{text-align:center;}
.topo{display:flex;gap:20px;flex-wrap:wrap;}
.topo img{
  width:180px;
  height:240px;
  object-fit:cover;
  border-radius:10px;
  border:2px solid #333;
}
.info span,td[contenteditable]{
  background:#222;
  padding:4px 6px;
  border-radius:4px;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  border:1px solid #333;
  padding:8px;
}
th{background:#222;}
button{
  background:#333;
  color:#fff;
  border:none;
  padding:5px 8px;
  margin:2px;
  border-radius:5px;
}
button:hover{background:#555;}
.secao{margin-top:30px;}
select{
  background:#222;
  color:#fff;
  border:1px solid #333;
  padding:5px;
}
canvas{
  max-width:100%;
  height:400px!important;
}
</style>
</head>

<body>
<div class="ficha">
<h1>Ficha de RPG</h1>

<button onclick="salvarFicha()">Salvar ficha</button>

<div class="topo">
<img src="https://via.placeholder.com/180x240">

<div class="info">
<p><b>Nome:</b> <span contenteditable id="nome">Herói</span></p>
<p><b>Nível:</b> <span contenteditable id="nivel">1</span></p>
<p><b>Raça:</b> <span contenteditable id="raca">Humano</span></p>
<p><b>Classe:</b> <span contenteditable id="classe">Guardião</span></p>

<p><b>Elemento:</b>
<select id="elemento" onchange="salvarElemento()">
<option>Fogo</option><option>Água</option><option>Terra</option><option>Ar</option>
<option>Raio</option><option>Gelo</option><option>Natureza</option><option>Madeira</option>
<option>Planta</option><option>Veneno</option><option>Areia</option><option>Lama</option>
<option>Pedra</option><option>Sombras</option><option>Trevas</option><option>Maldição</option>
<option>Corrupção</option><option>Vazio</option><option>Medo</option><option>Luz</option>
<option>Sagrado</option><option>Celestial</option><option>Astral</option><option>Estelar</option>
<option>Ordem</option><option>Caos</option><option>Infernal</option><option>Sangue</option>
<option>Sacrifício</option><option>Pecado</option><option>Mente</option><option>Psíquico</option>
<option>Sonho</option><option>Ilusão</option><option>Emoção</option><option>Metal</option>
<option>Ferro</option><option>Ossos</option><option>Cristal</option><option>Vidro</option>
<option>Tempo</option><option>Espaço</option><option>Gravidade</option><option>Destino</option>
<option>Acaso</option><option>Energia</option><option>Éter</option><option>Abismo</option>
<option>Cinzas</option><option>Névoa</option>
</select>
</p>

<p><b>Relação Elemental:</b>
<span id="infoElemento" style="color:#ffd700;">—</span>
</p>
</div>
</div>

<div class="secao">
<h2>Atributos</h2>
<table>
<tr><th>Atributo</th><th>Valor</th></tr>
<tr><td>Força</td><td contenteditable class="atrib" id="forca">12</td></tr>
<tr><td>Destreza</td><td contenteditable class="atrib" id="destreza">14</td></tr>
<tr><td>Constituição</td><td contenteditable class="atrib" id="constituicao">13</td></tr>
<tr><td>Inteligência</td><td contenteditable class="atrib" id="inteligencia">10</td></tr>
<tr><td>Sabedoria</td><td contenteditable class="atrib" id="sabedoria">11</td></tr>
<tr><td>Carisma</td><td contenteditable class="atrib" id="carisma">9</td></tr>
</table>

<canvas id="grafico"></canvas>
</div>
</div>

<script>
const repNome = window.location.pathname.split("/")[1] || "local";

/* ================= SISTEMA ELEMENTAL ================= */
const tabelaElemental = {
  Fogo:{fraco:"Água",forte:"Planta"},
  Água:{fraco:"Raio",forte:"Fogo"},
  Terra:{fraco:"Água",forte:"Raio"},
  Ar:{fraco:"Terra",forte:"Fogo"},
  Raio:{fraco:"Terra",forte:"Água"},
  Gelo:{fraco:"Fogo",forte:"Ar"},
  Natureza:{fraco:"Fogo",forte:"Terra"},
  Madeira:{fraco:"Fogo",forte:"Água"},
  Planta:{fraco:"Fogo",forte:"Água"},
  Veneno:{fraco:"Luz",forte:"Planta"},
  Areia:{fraco:"Água",forte:"Fogo"},
  Lama:{fraco:"Raio",forte:"Terra"},
  Pedra:{fraco:"Raio",forte:"Gelo"},
  Sombras:{fraco:"Luz",forte:"Medo"},
  Trevas:{fraco:"Luz",forte:"Psíquico"},
  Maldição:{fraco:"Sagrado",forte:"Emoção"},
  Corrupção:{fraco:"Ordem",forte:"Caos"},
  Vazio:{fraco:"Energia",forte:"Abismo"},
  Medo:{fraco:"Luz",forte:"Sonho"},
  Luz:{fraco:"Trevas",forte:"Maldição"},
  Cinzas:{fraco:"Água",forte:"Fogo"},
  Névoa:{fraco:"Ar",forte:"Sombras"}
};

function salvarElemento(){
  localStorage.setItem(`elemento-${repNome}`, elemento.value);
  atualizarInfoElemento();
}

function atualizarInfoElemento(){
  const el = localStorage.getItem(`elemento-${repNome}`);
  infoElemento.innerText = (el && tabelaElemental[el])
    ? `Fraqueza: ${tabelaElemental[el].fraco} | Vantagem: ${tabelaElemental[el].forte}`
    : "—";
}

/* ================= GRÁFICO ================= */
function getValores(){
  return [...document.querySelectorAll(".atrib")].map(e=>+e.innerText||0);
}
function indiceDominante(valores){
  return valores.indexOf(Math.max(...valores));
}

const grafico = new Chart(document.getElementById("grafico"),{
  type:"radar",
  data:{
    labels:["Força","Destreza","Constituição","Inteligência","Sabedoria","Carisma"],
    datasets:[{
      data:getValores(),
      backgroundColor:"rgba(0,200,255,.2)",
      borderColor:"#00c8ff",
      pointBackgroundColor:"#00c8ff",
      pointRadius:5
    }]
  },
  options:{scales:{r:{beginAtZero:true,max:100}}}
});

function atualizarGrafico(){
  const valores = getValores();
  const dom = indiceDominante(valores);
  grafico.data.datasets[0].data = valores;
  grafico.data.datasets[0].pointBackgroundColor =
    valores.map((_,i)=>i===dom?"#2ecc71":"#00c8ff");
  grafico.update();
  localStorage.setItem(`atributos-${repNome}`, JSON.stringify(valores));
}

document.querySelectorAll(".atrib").forEach(el=>{
  el.addEventListener("input", atualizarGrafico);
});

/* ================= SALVAR / CARREGAR ================= */
function salvarFicha(){
  document.querySelectorAll("[contenteditable]").forEach(el=>{
    if(el.id) localStorage.setItem(`${el.id}-${repNome}`, el.innerText);
  });
  salvarElemento();
  atualizarGrafico();
}

function carregarFicha(){
  document.querySelectorAll("[contenteditable]").forEach(el=>{
    const v = localStorage.getItem(`${el.id}-${repNome}`);
    if(v) el.innerText = v;
  });
  const el = localStorage.getItem(`elemento-${repNome}`);
  if(el) elemento.value = el;
  const atr = localStorage.getItem(`atributos-${repNome}`);
  if(atr){
    const v = JSON.parse(atr);
    document.querySelectorAll(".atrib").forEach((e,i)=>e.innerText=v[i]);
  }
  atualizarInfoElemento();
  atualizarGrafico();
}

window.onload = carregarFicha;
</script>
</body>
</html>
