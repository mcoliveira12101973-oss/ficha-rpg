<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Ficha de RPG</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  background:#0e0e0e;
  color:#eee;
  font-family:Arial,sans-serif;
  padding:20px;
}
.ficha{
  max-width:1100px;
  margin:auto;
  background:#1a1a1a;
  padding:20px;
  border-radius:12px;
}
h1,h2{text-align:center;}
.topo{display:flex;gap:20px;flex-wrap:wrap;}
.topo img{
  width:180px;
  height:240px;
  object-fit:cover;
  border-radius:10px;
  border:2px solid #333;
}
.info span,td[contenteditable]{
  background:#222;
  padding:4px 6px;
  border-radius:4px;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  border:1px solid #333;
  padding:8px;
}
th{background:#222;}
button{
  background:#333;
  color:#fff;
  border:none;
  padding:5px 8px;
  margin:2px;
  border-radius:5px;
}
button:hover{background:#555;}
.secao{margin-top:30px;}
select{
  background:#222;
  color:#fff;
  border:1px solid #333;
  padding:5px;
}
.barra{
  width:100%;
  height:18px;
  background:#333;
  border-radius:10px;
  overflow:hidden;
}
.barra div{height:100%;transition:.3s;}
.hp{background:#c0392b;}
.mp{background:#2980b9;}
canvas{max-width:100%;height:400px!important;}
</style>
</head>

<body>
<div class="ficha">
<h1>Ficha de RPG</h1>

<button onclick="salvarFicha()">Salvar ficha</button>

<div class="topo">
<img id="imgPersonagem" src="https://via.placeholder.com/180x240">

<div class="info">
<p><b>Nome:</b> <span contenteditable id="nome">Herói</span></p>
<p><b>Nível:</b> <span contenteditable id="nivel">1</span></p>
<p><b>Raça:</b> <span contenteditable id="raca">Humano</span></p>
<p><b>Classe:</b> <span contenteditable id="classe">Guardião</span></p>

<p><b>Elemento:</b>
<select id="elemento" onchange="salvarElemento()">
<option>Fogo</option><option>Água</option><option>Terra</option><option>Ar</option>
<option>Raio</option><option>Gelo</option><option>Natureza</option><option>Madeira</option>
<option>Planta</option><option>Veneno</option><option>Areia</option><option>Lama</option>
<option>Pedra</option><option>Sombras</option><option>Trevas</option><option>Maldição</option>
<option>Corrupção</option><option>Vazio</option><option>Medo</option><option>Luz</option>
<option>Sagrado</option><option>Celestial</option><option>Astral</option><option>Estelar</option>
<option>Ordem</option><option>Caos</option><option>Infernal</option><option>Sangue</option>
<option>Sacrifício</option><option>Pecado</option><option>Mente</option><option>Psíquico</option>
<option>Sonho</option><option>Ilusão</option><option>Emoção</option><option>Metal</option>
<option>Ferro</option><option>Ossos</option><option>Cristal</option><option>Vidro</option>
<option>Tempo</option><option>Espaço</option><option>Gravidade</option><option>Destino</option>
<option>Acaso</option><option>Energia</option><option>Éter</option><option>Abismo</option>
<option>Cinzas</option><option>Névoa</option>
</select>
</p>

<button onclick="definirImagem()">Adicionar imagem</button>
<button onclick="removerImagem()">Remover imagem</button>

<p><b>Relação Elemental:</b>
<span id="infoElemento" style="color:#ffd700;">—</span>
</p>
</div>
</div>

<div class="secao">
<h2>Status de Combate</h2>
<table>
<tr><th>Status</th><th>Atual</th><th>Máx</th><th>Ações</th></tr>

<tr>
<td>Vida (HP)</td>
<td contenteditable id="hpAtual">40</td>
<td contenteditable id="hpMax">50</td>
<td>
<button onclick="alterarHP(-1)">-1</button>
<button onclick="alterarHP(1)">+1</button>
<button onclick="alterarHP(-5)">-5</button>
<button onclick="alterarHP(5)">+5</button>
</td>
</tr>
<tr><td colspan="4"><div class="barra"><div id="hpBar" class="hp"></div></div></td></tr>

<tr>
<td>Mana (MP)</td>
<td contenteditable id="mpAtual">20</td>
<td contenteditable id="mpMax">30</td>
<td>
<button onclick="alterarMP(-1)">-1</button>
<button onclick="alterarMP(1)">+1</button>
<button onclick="alterarMP(-5)">-5</button>
<button onclick="alterarMP(5)">+5</button>
</td>
</tr>
<tr><td colspan="4"><div class="barra"><div id="mpBar" class="mp"></div></div></td></tr>
</table>
</div>

<div class="secao">
<h2>Atributos</h2>
<table>
<tr><th>Atributo</th><th>Valor</th></tr>
<tr><td>Força</td><td contenteditable class="atrib">12</td></tr>
<tr><td>Destreza</td><td contenteditable class="atrib">14</td></tr>
<tr><td>Constituição</td><td contenteditable class="atrib">13</td></tr>
<tr><td>Inteligência</td><td contenteditable class="atrib">10</td></tr>
<tr><td>Sabedoria</td><td contenteditable class="atrib">11</td></tr>
<tr><td>Carisma</td><td contenteditable class="atrib">9</td></tr>
</table>

<h2>Atributos de Combate</h2>
<table>
<tr><th>Atributo</th><th>Valor</th></tr>
<tr><td>Defesa / CA</td><td contenteditable id="defesa">10</td></tr>
<tr><td>Iniciativa</td><td contenteditable id="iniciativa">0</td></tr>
<tr><td>Deslocamento</td><td contenteditable id="deslocamento">9m</td></tr>
<tr><td>Mestria de Elemento</td><td contenteditable id="mestria">Nenhuma</td></tr>
</table>

<canvas id="grafico"></canvas>
</div>
</div>

<script>
const repNome="local";

/* ================= SISTEMA ELEMENTAL (ORIGINAL COMPLETO) ================= */
const tabelaElemental = {
  Fogo:{fraco:"Água",forte:"Planta"},
  Água:{fraco:"Raio",forte:"Fogo"},
  Terra:{fraco:"Água",forte:"Raio"},
  Ar:{fraco:"Terra",forte:"Fogo"},
  Raio:{fraco:"Terra",forte:"Água"},
  Gelo:{fraco:"Fogo",forte:"Ar"},
  Natureza:{fraco:"Fogo",forte:"Terra"},
  Madeira:{fraco:"Fogo",forte:"Água"},
  Planta:{fraco:"Fogo",forte:"Água"},
  Veneno:{fraco:"Luz",forte:"Planta"},
  Areia:{fraco:"Água",forte:"Fogo"},
  Lama:{fraco:"Raio",forte:"Terra"},
  Pedra:{fraco:"Raio",forte:"Gelo"},
  Sombras:{fraco:"Luz",forte:"Medo"},
  Trevas:{fraco:"Luz",forte:"Psíquico"},
  Maldição:{fraco:"Sagrado",forte:"Emoção"},
  Corrupção:{fraco:"Ordem",forte:"Caos"},
  Vazio:{fraco:"Energia",forte:"Abismo"},
  Medo:{fraco:"Luz",forte:"Sonho"},
  Luz:{fraco:"Trevas",forte:"Maldição"},
  Sagrado:{fraco:"Profano",forte:"Trevas"},
  Celestial:{fraco:"Caos",forte:"Infernal"},
  Astral:{fraco:"Espaço",forte:"Estelar"},
  Estelar:{fraco:"Abismo",forte:"Astral"},
  Ordem:{fraco:"Caos",forte:"Destino"},
  Caos:{fraco:"Ordem",forte:"Infernal"},
  Infernal:{fraco:"Sagrado",forte:"Sangue"},
  Sangue:{fraco:"Veneno",forte:"Sacrifício"},
  Sacrifício:{fraco:"Pecado",forte:"Sagrado"},
  Pecado:{fraco:"Ordem",forte:"Emoção"},
  Mente:{fraco:"Emoção",forte:"Psíquico"},
  Psíquico:{fraco:"Trevas",forte:"Sonho"},
  Sonho:{fraco:"Ordem",forte:"Ilusão"},
  Ilusão:{fraco:"Luz",forte:"Emoção"},
  Emoção:{fraco:"Mente",forte:"Pecado"},
  Metal:{fraco:"Raio",forte:"Veneno"},
  Ferro:{fraco:"Fogo",forte:"Ossos"},
  Ossos:{fraco:"Metal",forte:"Veneno"},
  Cristal:{fraco:"Sombras",forte:"Luz"},
  Vidro:{fraco:"Pedra",forte:"Gelo"},
  Tempo:{fraco:"Caos",forte:"Destino"},
  Espaço:{fraco:"Gravidade",forte:"Astral"},
  Gravidade:{fraco:"Espaço",forte:"Ar"},
  Destino:{fraco:"Acaso",forte:"Tempo"},
  Acaso:{fraco:"Ordem",forte:"Destino"},
  Energia:{fraco:"Abismo",forte:"Éter"},
  Éter:{fraco:"Vazio",forte:"Energia"},
  Abismo:{fraco:"Luz",forte:"Vazio"},
  Cinzas:{fraco:"Água",forte:"Fogo"},
  Névoa:{fraco:"Ar",forte:"Sombras"}
};

function salvarElemento(){
  localStorage.setItem("elemento-"+repNome, elemento.value);
  atualizarInfoElemento();
}

function atualizarInfoElemento(){
  const el = localStorage.getItem("elemento-"+repNome);
  if(el && tabelaElemental[el]){
    infoElemento.innerText =
      `Fraqueza: ${tabelaElemental[el].fraco} | Vantagem: ${tabelaElemental[el].forte}`;
  } else {
    infoElemento.innerText = "—";
  }
}

/* ================= VIDA / MANA ================= */
function alterarHP(v){
  let a=+hpAtual.innerText||0,m=+hpMax.innerText||0;
  a=Math.min(Math.max(a+v,0),m);
  hpAtual.innerText=a;
  if(a>0)window.hpAvisado=false;
  atualizarBarras();
}
function alterarMP(v){
  let a=+mpAtual.innerText||0,m=+mpMax.innerText||0;
  a=Math.min(Math.max(a+v,0),m);
  mpAtual.innerText=a;
  atualizarBarras();
}
function atualizarBarras(){
  let hpA=+hpAtual.innerText||0,hpM=+hpMax.innerText||1;
  let mpA=+mpAtual.innerText||0,mpM=+mpMax.innerText||1;

  let hpP=(hpA/hpM)*100, mpP=(mpA/mpM)*100;
  hpBar.style.width=hpP+"%";
  mpBar.style.width=mpP+"%";
  hpBar.style.background=hpP<=25?"#e74c3c":"#c0392b";

  if(hpA===0&&!window.hpAvisado){
    window.hpAvisado=true;
    alert("⚠️ ATENÇÃO!\nO personagem chegou a 0 de HP!");
  }
}

/* ================= IMAGEM ================= */
function definirImagem(){
  const l=prompt("Cole o link da imagem:");
  if(l)imgPersonagem.src=l;
}
function removerImagem(){
  imgPersonagem.src="https://via.placeholder.com/180x240";
}

/* ================= GRÁFICO ================= */
function getValores(){return [...document.querySelectorAll(".atrib")].map(e=>+e.innerText||0);}
function indiceDominante(v){return v.indexOf(Math.max(...v));}

const grafico=new Chart(document.getElementById("grafico"),{
  type:"radar",
  data:{
    labels:["Força","Destreza","Constituição","Inteligência","Sabedoria","Carisma"],
    datasets:[{
      data:getValores(),
      backgroundColor:"rgba(0,200,255,.2)",
      borderColor:"#00c8ff",
      pointBackgroundColor:"#00c8ff"
    }]
  },
  options:{scales:{r:{beginAtZero:true,max:100}}}
});

function atualizarGrafico(){
  const v=getValores(),d=indiceDominante(v);
  grafico.data.datasets[0].data=v;
  grafico.data.datasets[0].pointBackgroundColor=
    v.map((_,i)=>i===d?"#2ecc71":"#00c8ff");
  grafico.update();
}
document.querySelectorAll(".atrib").forEach(e=>e.addEventListener("input",atualizarGrafico));

/* ================= SALVAR / CARREGAR ================= */
function salvarFicha(){
  document.querySelectorAll("[contenteditable]").forEach(e=>{
    if(e.id)localStorage.setItem(e.id+"-"+repNome,e.innerText);
  });
  localStorage.setItem("elemento-"+repNome,elemento.value);
  localStorage.setItem("img-"+repNome,imgPersonagem.src);
}
function carregarFicha(){
  document.querySelectorAll("[contenteditable]").forEach(e=>{
    const v=localStorage.getItem(e.id+"-"+repNome);
    if(v)e.innerText=v;
  });
  const el=localStorage.getItem("elemento-"+repNome);
  if(el)elemento.value=el;
  const img=localStorage.getItem("img-"+repNome);
  if(img)imgPersonagem.src=img;
  atualizarInfoElemento();
  atualizarBarras();
  atualizarGrafico();
}
window.onload=carregarFicha;
</script>
</body>
</html>
