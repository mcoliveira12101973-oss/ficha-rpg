<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Ficha de RPG</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  background:#0e0e0e;
  color:#eee;
  font-family:Arial,sans-serif;
  padding:20px
}
.ficha{
  max-width:1100px;
  margin:auto;
  background:#1a1a1a;
  padding:20px;
  border-radius:12px
}
h1,h2{text-align:center}
.topo{display:flex;gap:20px;flex-wrap:wrap}
.topo img{
  width:180px;height:240px;
  object-fit:cover;
  border-radius:10px;
  border:2px solid #333
}
.info span,td[contenteditable]{
  background:#222;
  padding:4px 6px;
  border-radius:4px
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px
}
th,td{
  border:1px solid #333;
  padding:8px
}
th{background:#222}
.barra{
  width:100%;
  height:18px;
  background:#333;
  border-radius:10px;
  overflow:hidden
}
.barra div{height:100%;transition:width .4s}
.hp{background:#c0392b}
.mp{background:#2980b9}
button{
  background:#333;
  color:white;
  border:none;
  padding:5px 8px;
  margin:2px;
  border-radius:5px
}
button:hover{background:#555}
.secao{margin-top:30px}
select{
  background:#222;
  color:#fff;
  border:1px solid #333;
  padding:5px
}
canvas{
  width:100%!important;
  height:420px!important
}
</style>
</head>

<body>
<div class="ficha">
<h1>Ficha de RPG</h1>
<button onclick="salvarFicha()">Salvar ficha</button>

<div class="topo">
<img src="https://via.placeholder.com/180x240">
<div class="info">
<p><b>Nome:</b> <span contenteditable id="nome">Herói</span></p>
<p><b>Nível:</b> <span contenteditable id="nivel">1</span></p>
<p><b>Raça:</b> <span contenteditable id="raca">Humano</span></p>
<p><b>Classe:</b> <span contenteditable id="classe">Guardião</span></p>

<p><b>Elemento:</b>
<select id="elemento" onchange="salvarElemento()">
<option>Fogo</option><option>Água</option><option>Terra</option><option>Ar</option>
<option>Raio</option><option>Gelo</option><option>Natureza</option><option>Madeira</option>
<option>Planta</option><option>Veneno</option><option>Areia</option><option>Lama</option>
<option>Pedra</option><option>Sombras</option><option>Trevas</option><option>Maldição</option>
<option>Corrupção</option><option>Vazio</option><option>Medo</option><option>Luz</option>
<option>Sagrado</option><option>Celestial</option><option>Astral</option><option>Estelar</option>
<option>Ordem</option><option>Caos</option><option>Infernal</option><option>Sangue</option>
<option>Sacrifício</option><option>Pecado</option><option>Mente</option><option>Psíquico</option>
<option>Sonho</option><option>Ilusão</option><option>Emoção</option><option>Metal</option>
<option>Ferro</option><option>Ossos</option><option>Cristal</option><option>Vidro</option>
<option>Tempo</option><option>Espaço</option><option>Gravidade</option><option>Destino</option>
<option>Acaso</option><option>Energia</option><option>Éter</option><option>Abismo</option>
<option>Cinzas</option><option>Névoa</option>
</select></p>

<div style="margin-top:10px">
<button onclick="definirImagem()">Adicionar imagem</button>
<button onclick="removerImagem()">Remover imagem</button>
</div>

<p><b>Relação Elemental:</b>
<span id="infoElemento" style="color:#ffd700">—</span>
</p>
</div>
</div>

<div class="secao">
<h2>Status de Combate</h2>
<table>
<tr><th>Item</th><th>Atual</th><th>Máx</th><th>Ações</th></tr>
<tr>
<td>PV</td>
<td contenteditable id="hpAtual">40</td>
<td contenteditable id="hpMax">50</td>
<td>
<button onclick="alterarHP(-5)">-5</button>
<button onclick="alterarHP(5)">+5</button>
</td>
</tr>
<tr><td colspan="4"><div class="barra"><div id="hpBar" class="hp"></div></div></td></tr>
<tr>
<td>PM</td>
<td contenteditable id="mpAtual">20</td>
<td contenteditable id="mpMax">30</td>
<td>
<button onclick="alterarMP(-5)">-5</button>
<button onclick="alterarMP(5)">+5</button>
</td>
</tr>
<tr><td colspan="4"><div class="barra"><div id="mpBar" class="mp"></div></div></td></tr>
</table>
</div>

<div class="secao">
<h2>Atributos</h2>
<table>
<tr><th>Atributo</th><th>Valor</th></tr>
<tr><td>Força</td><td contenteditable class="atrib" id="forca">12</td></tr>
<tr><td>Destreza</td><td contenteditable class="atrib" id="destreza">14</td></tr>
<tr><td>Constituição</td><td contenteditable class="atrib" id="constituicao">13</td></tr>
<tr><td>Inteligência</td><td contenteditable class="atrib" id="inteligencia">10</td></tr>
<tr><td>Sabedoria</td><td contenteditable class="atrib" id="sabedoria">11</td></tr>
<tr><td>Carisma</td><td contenteditable class="atrib" id="carisma">9</td></tr>
</table>

<h2>Atributos de Combate</h2>
<table>
<tr><th>Atributo</th><th>Valor</th></tr>
<tr><td>Defesa / CA</td><td contenteditable id="defesa">10</td></tr>
<tr><td>Iniciativa</td><td contenteditable id="iniciativa">0</td></tr>
<tr><td>Deslocamento</td><td contenteditable id="deslocamento">9m</td></tr>
<tr><td>Mestria de Elemento</td><td contenteditable id="mestria">Nenhuma</td></tr>
</table>

<canvas id="grafico"></canvas>
</div>
</div>

<script>
const repNome=location.pathname.split("/")[1]||"local";
const canvas=document.getElementById("grafico");

function atualizarBarras(){
  hpBar.style.width=(hpAtual.innerText/hpMax.innerText*100)+"%";
  mpBar.style.width=(mpAtual.innerText/mpMax.innerText*100)+"%";
}
function alterarHP(v){
  hpAtual.innerText=Math.min(+hpMax.innerText,Math.max(0,+hpAtual.innerText+v));
  atualizarBarras()
}
function alterarMP(v){
  mpAtual.innerText=Math.min(+mpMax.innerText,Math.max(0,+mpAtual.innerText+v));
  atualizarBarras()
}

function cor(v){
  if(v>=70)return"rgba(46,204,113,.6)";
  if(v>=40)return"rgba(241,196,15,.6)";
  return"rgba(231,76,60,.6)"
}
function borda(v){
  if(v>=70)return"rgba(46,204,113,1)";
  if(v>=40)return"rgba(241,196,15,1)";
  return"rgba(231,76,60,1)"
}

Chart.register({
  id:"valoresRadar",
  afterDatasetsDraw(chart){
    const ctx=chart.ctx;
    ctx.fillStyle="#fff";
    ctx.font="bold 12px Arial";
    chart.data.datasets[0].data.forEach((v,i)=>{
      const p=chart.getDatasetMeta(0).data[i];
      ctx.fillText(v,p.x,p.y-8)
    })
  }
});

let dados=JSON.parse(localStorage.getItem(`grafico-${repNome}`))||
[12,14,13,10,11,9];

const grafico=new Chart(canvas,{
  type:"radar",
  data:{
    labels:["Força","Destreza","Constituição","Inteligência","Sabedoria","Carisma"],
    datasets:[{
      data:dados,
      backgroundColor:dados.map(cor),
      borderColor:dados.map(borda),
      pointBackgroundColor:dados.map(borda),
      pointRadius:dados.map(v=>v==Math.max(...dados)?8:5)
    }]
  },
  options:{
    responsive:true,
    maintainAspectRatio:false,
    scales:{r:{beginAtZero:true,max:100}}
  }
});

document.querySelectorAll(".atrib").forEach(a=>{
  a.addEventListener("input",()=>{
    const v=[...document.querySelectorAll(".atrib")].map(x=>+x.innerText||0);
    localStorage.setItem(`grafico-${repNome}`,JSON.stringify(v));
    grafico.data.datasets[0].data=v;
    grafico.data.datasets[0].backgroundColor=v.map(cor);
    grafico.data.datasets[0].borderColor=v.map(borda);
    grafico.data.datasets[0].pointBackgroundColor=v.map(borda);
    grafico.data.datasets[0].pointRadius=v.map(x=>x==Math.max(...v)?8:5);
    grafico.update()
  })
});

const img=document.querySelector(".topo img");
function definirImagem(){
  const l=prompt("Link da imagem:");
  if(l)img.src=l
}
function removerImagem(){
  img.src="https://via.placeholder.com/180x240"
}

function salvarFicha(){
  localStorage.setItem(`imagem-${repNome}`,img.src);
  document.querySelectorAll("[contenteditable]").forEach(e=>{
    localStorage.setItem(`${e.id}-${repNome}`,e.innerText)
  });
  localStorage.setItem(`elemento-${repNome}`,elemento.value);
  alert("Ficha salva!")
}

function carregarFicha(){
  const i=localStorage.getItem(`imagem-${repNome}`);
  if(i)img.src=i;
  document.querySelectorAll("[contenteditable]").forEach(e=>{
    const v=localStorage.getItem(`${e.id}-${repNome}`);
    if(v)e.innerText=v
  });
  atualizarBarras()
}
window.onload=carregarFicha;
</script>
</body>
</html>
